<html>
  <meta charset="UTF-8" />

  <head>
    <title>Tamil Wordle</title>
    <style>
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
      }
    </style>
  </head>

  <body>
    <label id="lengthLabel"></label> роОро┤рпБродрпНродрпБ(роХрпН)роХро│рпН роЕро│ро╡рпБ роирпАро│рооро╛рой родрооро┐ро┤рпНроЪрпНроЪрпКро▓рпНро▓рпИ,
    родрооро┐ро┤ро┐ро▓рпН родроЯрпНроЯроЪрпНроЪрпБ роЪрпЖропрпНродрпБ, 'роЪро░ро┐' рокрпКродрпНродро╛ройрпИ роЕро┤рпБродрпНродро╡рпБроорпН <br />
    <input type="text" id="curword" />
    <button onclick="process()">роЪро░ро┐</button>
    <hr />
    <p>тЭдя╕П - роЪро░ро┐ропро╛рой роОро┤рпБродрпНродрпБ</p>
    <p>ЁЯЩИ - роЗро▓рпНро▓ро╛род роОро┤рпБродрпНродрпБ, роХроЯро▓рпНро▓рпИропрпЗ роЗро▓рпНро▓рпИропро╛роорпН</p>
    <p>ЁЯСА - родро╡ро▒ро╛рой роЗроЯродрпНродро┐ро▓рпН роЙро│рпНро│ роЪро░ро┐ропро╛рой роОро┤рпБродрпНродрпБ</p>
    <p>ЁЯРг - роЙропро┐ро░рпН роОро┤рпБродрпНродрпБрокрпН рокрпКро░рпБродрпНродроорпН (роЕ роЖ роЗ роИ ...)</p>
    <p>ЁЯПЛя╕П - роорпЖропрпН роОро┤рпБродрпНродрпБрокрпН рокрпКро░рпБродрпНродроорпН (роХ роХро╛ роХро┐ роХрпА ...)</p>
    <hr />
    <div>
      <table id="tilesTable"></table>
    </div>
    <hr />
    <div id="historyDiv"></div>
  </body>

  <script>
    function process() {
      var str = document.getElementById("curword").value.trim();

      var diacritics = {
        "\u0B82": true,
        "\u0BBE": true,
        "\u0BBF": true,
        "\u0BC0": true,
        "\u0BC1": true,
        "\u0BC2": true,
        "\u0BC6": true,
        "\u0BC7": true,
        "\u0BC8": true,
        "\u0BCA": true,
        "\u0BCB": true,
        "\u0BCC": true,
        "\u0BCD": true,
        "\u0BD7": true,
      };

      var targetList = [];
      for (var i = 0; i != str.length; i++) {
        var ch = str[i];
        diacritics[ch]
          ? (targetList[targetList.length - 1] += ch)
          : targetList.push(ch);
      }

      const http = new XMLHttpRequest();
      http.open("POST", "/verify-word-with-uyirmei");
      http.setRequestHeader("Content-Type", "application/json");
      http.send(JSON.stringify(targetList));

      http.onreadystatechange = (e) => {
        if (http.readyState === XMLHttpRequest.DONE) {
          switch (http.status) {
            case 202:
              alert(
                "роЪро░ро┐ропро╛рой роЪрпКро▓рпНро▓рпИроХрпН роХрогрпНроЯрпБрокро┐роЯро┐родрпНродрпБро╡ро┐роЯрпНроЯрпАро░рпНроХро│рпН !!! If you are interested, copy and paste the emoji table to social media."
              );
              var tilesTable = document.getElementById("tilesTable");
              var row = tilesTable.insertRow();

              for (var i = 0; i < jsonResponse.length; i++) {
                var cell = row.insertCell();
                cell.innerHTML = " тЭдя╕П ";
              }
              document.getElementById("curword").value = "";

              return;
            case 200:
              jsonResponse = JSON.parse(http.responseText);

              var historyDiv = document.getElementById("historyDiv");
              var historyEntry = document.createElement("Label");
              historyEntry.innerHTML = str;
              var historyBreak = document.createElement("br");
              historyDiv.appendChild(historyEntry);
              historyDiv.appendChild(historyBreak);

              var tilesTable = document.getElementById("tilesTable");
              var row = tilesTable.insertRow();

              for (var i = 0; i < jsonResponse.length; i++) {
                var resp = jsonResponse[i];
                var cell = row.insertCell();

                var cellBody = "";
                for (var j = 0; j < resp.length; j++) {
                  var msg = resp[j];
                  switch (msg) {
                    case "LETTER_NOT_FOUND":
                      cellBody += "   ЁЯЩИ   ";
                      break;
                    case "LETTER_ELSEWHERE":
                      cellBody += "   ЁЯСА   ";
                      break;
                    case "LETTER_MATCHED":
                      cellBody += "   тЭдя╕П   ";
                      break;
                    case "UYIR_MATCHED":
                      cellBody += "   ЁЯРг   ";
                      break;
                    case "MEI_MATCHED":
                      cellBody += "   ЁЯПЛя╕П   ";
                      break;
                    default:
                      alert("Error in game:", msg);
                      break;
                  }
                }
                cell.innerHTML = cellBody;
              }
              document.getElementById("curword").value = "";
              return;
            default:
              alert(http.responseText);
              return;
          }
        }
      };
    }

    function loadLen() {
      const http = new XMLHttpRequest();
      http.open("GET", "/get-current-word-len");
      http.onreadystatechange = (e) => {
        if (http.readyState === XMLHttpRequest.DONE) {
          var status = http.status;

          if (status !== 200) {
            console.log("some error happened", http.status);
            alert("Error loading the game!");
            return;
          }

          var jsonResponse = JSON.parse(http.responseText);
          var lengthLabel = document.getElementById("lengthLabel");
          lengthLabel.innerText = jsonResponse.Length;
        }
      };
      http.send();
    }

    window.onload = loadLen();
  </script>
</html>
